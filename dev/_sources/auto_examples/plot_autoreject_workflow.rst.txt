
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plot_autoreject_workflow.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_plot_autoreject_workflow.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_autoreject_workflow.py:


.. _plot_autoreject_workflow:

===================================================
Preprocessing workflow with ``autoreject`` and ICA
===================================================
This example demonstrates how to visualize data when preprocessing
with :mod:`autoreject` and discusses decisions about when and which
other preprocessing steps to use in combination.

**tldr**: We recommend that you first highpass filter the data,
then run autoreject (local) and supply the bad epochs detected by it
to the ICA algorithm for a robust fit, and finally run
autoreject (local) again.

.. GENERATED FROM PYTHON SOURCE LINES 17-26

.. code-block:: default


    # Author: Alex Rockhill <aprockhill@mailbox.org>
    #         Mainak Jas <mjas@mgh.harvard.edu>
    #         Apoorva Karekal <apoorvak@uoregon.edu>
    #
    # License: BSD-3-Clause

    # sphinx_gallery_thumbnail_number = 9








.. GENERATED FROM PYTHON SOURCE LINES 27-33

.. contents:: Table of Contents
   :local:

First, we download resting-state EEG data from a Parkinson's patient
from OpenNeuro. We will do this using ``openneuro-py`` which can be
installed with the command ``pip install openneuro-py``.

.. GENERATED FROM PYTHON SOURCE LINES 33-48

.. code-block:: default


    import os.path as op
    import matplotlib.pyplot as plt
    import openneuro

    import mne
    import autoreject

    dataset = 'ds002778'  # The id code on OpenNeuro for this example dataset
    subject_id = 'pd14'

    target_dir = op.join(op.dirname(autoreject.__file__), '..', 'examples')
    openneuro.download(dataset=dataset, target_dir=target_dir,
                       include=[f'sub-{subject_id}/ses-off'])





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Hello! This is openneuro-py 2022.1.0. Great to see you!

          Please report problems and bugs at
          https://github.com/hoechenberger/openneuro-py/issues

    Preparing to download ds002778 ...
    Cannot determine local revision of the dataset ,and the target directory is not empty. If the download fails, you may want to try again with a fresh (empty) target directory.
    Retrieving up to 12 files (5 concurrent downloads).
    participants.tsv:   0%|          | 0.00/1.62k [00:00<?, ?B/s]                                                                 participants.json:   0%|          | 0.00/1.24k [00:00<?, ?B/s]                                                                  dataset_description.json: 0.00B [00:00, ?B/s]                                                 README: 0.00B [00:00, ?B/s]                               CHANGES: 0.00B [00:00, ?B/s]                                sub-pd14_ses-off_scans.tsv:   0%|          | 0.00/76.0 [00:00<?, ?B/s]                                                                          sub-pd14_ses-off_task-rest_eeg.bdf:   0%|          | 0.00/17.5M [00:00<?, ?B/s]
    sub-pd14_ses-off_task-rest_eeg.json:   0%|          | 0.00/471 [00:00<?, ?B/s]
                                                                                  
    sub-pd14_ses-off_task-rest_events.tsv:   0%|          | 0.00/65.0 [00:00<?, ?B/s]
                                                                                     
    sub-pd14_ses-off_task-rest_channels.tsv: 0.00B [00:00, ?B/s]
                                                                    sub-pd14_ses-off_task-rest_eeg.bdf:  12%|#1        | 2.08M/17.5M [00:00<00:00, 21.8MB/s]
    sub-pd14_ses-off_task-rest_beh.json: 0.00B [00:00, ?B/s]
                                                                sub-pd14_ses-off_task-rest_eeg.bdf:  39%|###8      | 6.79M/17.5M [00:00<00:00, 38.0MB/s]
    sub-pd14_ses-off_task-rest_beh.tsv: 0.00B [00:00, ?B/s]
                                                               sub-pd14_ses-off_task-rest_eeg.bdf:  69%|######8   | 12.0M/17.5M [00:00<00:00, 45.7MB/s]                                                                                            Finished downloading ds002778.

    Please enjoy your brains.





.. GENERATED FROM PYTHON SOURCE LINES 49-55

We will now load in the raw data from the bdf file downloaded from OpenNeuro
and, since this is resting-state data without any events, make regularly
spaced events with which to epoch the raw data. In the averaged plot,
we can see that there may be some eyeblink
artifact contamination but, overall, the data is typical of
resting-state EEG.

.. GENERATED FROM PYTHON SOURCE LINES 55-68

.. code-block:: default


    raw_fname = op.join(target_dir, f'sub-{subject_id}',
                        'ses-off', 'eeg', 'sub-pd14_ses-off_task-rest_eeg.bdf')
    raw = mne.io.read_raw_bdf(raw_fname, preload=True)
    dig_montage = mne.channels.make_standard_montage('biosemi32')
    raw.drop_channels([ch for ch in raw.ch_names
                       if ch not in dig_montage.ch_names])
    raw.set_montage(dig_montage)  # use the standard montage
    epochs = mne.make_fixed_length_epochs(raw, duration=3, preload=True)

    # plot the data
    epochs.average().detrend().plot_joint()




.. image-sg:: /auto_examples/images/sphx_glr_plot_autoreject_workflow_001.png
   :alt: 0.006 s, 0.979 s, 2.699 s
   :srcset: /auto_examples/images/sphx_glr_plot_autoreject_workflow_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Extracting EDF parameters from /home/circleci/project/examples/sub-pd14/ses-off/eeg/sub-pd14_ses-off_task-rest_eeg.bdf...
    BDF file detected
    Setting channel info structure...
    Creating raw.info structure...
    Reading 0 ... 149503  =      0.000 ...   291.998 secs...
    Not setting metadata
    97 matching events found
    No baseline correction applied
    0 projection items activated
    Using data from preloaded Raw for 97 events and 1536 original time points ...
    0 bad epochs dropped
    No projector specified for this dataset. Please consider the method self.add_proj.

    <Figure size 800x420 with 7 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 69-80

Autoreject without any other preprocessing
------------------------------------------
Now, we'll naively apply autoreject as our first preprocessing step.

As we can see in the plot of the rejected epochs, there are many eyeblinks
that caused the epoch to be dropped. This resulted in a lot of the data
being lost.

The data looks fairly clean already and we don't want to interpolate
more than a few sensors since we only have 32 to start, so the
number of channels to interpolate was set to check some low numbers

.. GENERATED FROM PYTHON SOURCE LINES 80-85

.. code-block:: default

    ar = autoreject.AutoReject(n_interpolate=[1, 2, 3, 4], random_state=11,
                               n_jobs=1, verbose=True)
    ar.fit(epochs[:20])  # fit on a few epochs to save time
    epochs_ar, reject_log = ar.transform(epochs, return_log=True)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Running autoreject on ch_type=eeg
      0%|          | Creating augmented epochs : 0/32 [00:00<?,       ?it/s]      6%|6         | Creating augmented epochs : 2/32 [00:00<00:00,  118.39it/s]     12%|#2        | Creating augmented epochs : 4/32 [00:00<00:00,  111.33it/s]     19%|#8        | Creating augmented epochs : 6/32 [00:00<00:00,  110.18it/s]     25%|##5       | Creating augmented epochs : 8/32 [00:00<00:00,  111.03it/s]     31%|###1      | Creating augmented epochs : 10/32 [00:00<00:00,  111.50it/s]     38%|###7      | Creating augmented epochs : 12/32 [00:00<00:00,  111.34it/s]     44%|####3     | Creating augmented epochs : 14/32 [00:00<00:00,  110.23it/s]     50%|#####     | Creating augmented epochs : 16/32 [00:00<00:00,  110.54it/s]     56%|#####6    | Creating augmented epochs : 18/32 [00:00<00:00,  110.60it/s]     62%|######2   | Creating augmented epochs : 20/32 [00:00<00:00,  110.69it/s]     69%|######8   | Creating augmented epochs : 22/32 [00:00<00:00,  110.15it/s]     75%|#######5  | Creating augmented epochs : 24/32 [00:00<00:00,  110.77it/s]     81%|########1 | Creating augmented epochs : 26/32 [00:00<00:00,  111.31it/s]     88%|########7 | Creating augmented epochs : 28/32 [00:00<00:00,  111.57it/s]     94%|#########3| Creating augmented epochs : 30/32 [00:00<00:00,  111.47it/s]    100%|##########| Creating augmented epochs : 32/32 [00:00<00:00,  111.41it/s]    100%|##########| Creating augmented epochs : 32/32 [00:00<00:00,  111.19it/s]
      0%|          | Computing thresholds ... : 0/32 [00:00<?,       ?it/s]      3%|3         | Computing thresholds ... : 1/32 [00:00<00:09,    3.43it/s]      6%|6         | Computing thresholds ... : 2/32 [00:00<00:08,    3.36it/s]      9%|9         | Computing thresholds ... : 3/32 [00:00<00:08,    3.34it/s]     12%|#2        | Computing thresholds ... : 4/32 [00:01<00:08,    3.33it/s]     16%|#5        | Computing thresholds ... : 5/32 [00:01<00:07,    3.38it/s]     19%|#8        | Computing thresholds ... : 6/32 [00:01<00:07,    3.36it/s]     22%|##1       | Computing thresholds ... : 7/32 [00:02<00:07,    3.38it/s]     25%|##5       | Computing thresholds ... : 8/32 [00:02<00:07,    3.37it/s]     28%|##8       | Computing thresholds ... : 9/32 [00:02<00:06,    3.37it/s]     31%|###1      | Computing thresholds ... : 10/32 [00:02<00:06,    3.38it/s]     34%|###4      | Computing thresholds ... : 11/32 [00:03<00:06,    3.38it/s]     38%|###7      | Computing thresholds ... : 12/32 [00:03<00:05,    3.40it/s]     41%|####      | Computing thresholds ... : 13/32 [00:03<00:05,    3.39it/s]     44%|####3     | Computing thresholds ... : 14/32 [00:04<00:05,    3.40it/s]     47%|####6     | Computing thresholds ... : 15/32 [00:04<00:04,    3.40it/s]     50%|#####     | Computing thresholds ... : 16/32 [00:04<00:04,    3.41it/s]     53%|#####3    | Computing thresholds ... : 17/32 [00:04<00:04,    3.42it/s]     56%|#####6    | Computing thresholds ... : 18/32 [00:05<00:04,    3.43it/s]     59%|#####9    | Computing thresholds ... : 19/32 [00:05<00:03,    3.44it/s]     62%|######2   | Computing thresholds ... : 20/32 [00:05<00:03,    3.43it/s]     66%|######5   | Computing thresholds ... : 21/32 [00:06<00:03,    3.43it/s]     69%|######8   | Computing thresholds ... : 22/32 [00:06<00:02,    3.44it/s]     72%|#######1  | Computing thresholds ... : 23/32 [00:06<00:02,    3.45it/s]     75%|#######5  | Computing thresholds ... : 24/32 [00:06<00:02,    3.45it/s]     78%|#######8  | Computing thresholds ... : 25/32 [00:07<00:02,    3.45it/s]     81%|########1 | Computing thresholds ... : 26/32 [00:07<00:01,    3.44it/s]     84%|########4 | Computing thresholds ... : 27/32 [00:07<00:01,    3.43it/s]     88%|########7 | Computing thresholds ... : 28/32 [00:08<00:01,    3.42it/s]     91%|######### | Computing thresholds ... : 29/32 [00:08<00:00,    3.42it/s]     94%|#########3| Computing thresholds ... : 30/32 [00:08<00:00,    3.42it/s]     97%|#########6| Computing thresholds ... : 31/32 [00:09<00:00,    3.43it/s]    100%|##########| Computing thresholds ... : 32/32 [00:09<00:00,    3.42it/s]    100%|##########| Computing thresholds ... : 32/32 [00:09<00:00,    3.42it/s]


      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     40%|####      | Repairing epochs : 8/20 [00:00<00:00,  457.33it/s]

     80%|########  | Repairing epochs : 16/20 [00:00<00:00,  459.01it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  456.65it/s]

      0%|          | n_interp : 0/4 [00:00<?,       ?it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     25%|##5       | Repairing epochs : 5/20 [00:00<00:00,  293.01it/s]

     50%|#####     | Repairing epochs : 10/20 [00:00<00:00,  239.83it/s]

     75%|#######5  | Repairing epochs : 15/20 [00:00<00:00,  247.28it/s]

     90%|######### | Repairing epochs : 18/20 [00:00<00:00,  222.31it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  235.45it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   14.08it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   16.44it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   17.97it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   18.83it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   19.37it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   19.71it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   19.95it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   20.13it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   20.22it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   20.30it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   20.08it/s]

     25%|##5       | n_interp : 1/4 [00:00<00:01,    1.70it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     35%|###5      | Repairing epochs : 7/20 [00:00<00:00,  285.62it/s]

     60%|######    | Repairing epochs : 12/20 [00:00<00:00,  282.58it/s]

     80%|########  | Repairing epochs : 16/20 [00:00<00:00,  246.20it/s]

    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  246.75it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  247.24it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   14.05it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   17.01it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   18.37it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   19.12it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   19.62it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   19.94it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   20.21it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   20.40it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   20.57it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   20.69it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   20.44it/s]

     50%|#####     | n_interp : 2/4 [00:01<00:01,    1.72it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     35%|###5      | Repairing epochs : 7/20 [00:00<00:00,  288.30it/s]

     60%|######    | Repairing epochs : 12/20 [00:00<00:00,  286.28it/s]

     80%|########  | Repairing epochs : 16/20 [00:00<00:00,  247.56it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  249.53it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   14.17it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   17.13it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   18.50it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   19.27it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   19.78it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   20.12it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   20.38it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   20.58it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   20.73it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   20.85it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   20.60it/s]

     75%|#######5  | n_interp : 3/4 [00:01<00:00,    1.73it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     35%|###5      | Repairing epochs : 7/20 [00:00<00:00,  288.07it/s]

     60%|######    | Repairing epochs : 12/20 [00:00<00:00,  287.83it/s]

     80%|########  | Repairing epochs : 16/20 [00:00<00:00,  248.08it/s]

    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  248.49it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  249.05it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   15.77it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   18.64it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   20.27it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   21.17it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   21.73it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   22.06it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   22.30it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   22.47it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   22.60it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   22.67it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   22.43it/s]

    100%|##########| n_interp : 4/4 [00:02<00:00,    1.77it/s]    100%|##########| n_interp : 4/4 [00:02<00:00,    1.76it/s]




    Estimated consensus=0.10 and n_interpolate=1


      0%|          | Repairing epochs : 0/97 [00:00<?,       ?it/s]

      6%|6         | Repairing epochs : 6/97 [00:00<00:00,  372.50it/s]

     10%|#         | Repairing epochs : 10/97 [00:00<00:00,  259.07it/s]

     15%|#5        | Repairing epochs : 15/97 [00:00<00:00,  261.43it/s]

     19%|#8        | Repairing epochs : 18/97 [00:00<00:00,  230.68it/s]

     25%|##4       | Repairing epochs : 24/97 [00:00<00:00,  243.39it/s]

     29%|##8       | Repairing epochs : 28/97 [00:00<00:00,  230.78it/s]

     34%|###4      | Repairing epochs : 33/97 [00:00<00:00,  238.18it/s]

     38%|###8      | Repairing epochs : 37/97 [00:00<00:00,  228.35it/s]

     43%|####3     | Repairing epochs : 42/97 [00:00<00:00,  234.65it/s]

     48%|####8     | Repairing epochs : 47/97 [00:00<00:00,  230.05it/s]

     54%|#####3    | Repairing epochs : 52/97 [00:00<00:00,  235.29it/s]

     57%|#####6    | Repairing epochs : 55/97 [00:00<00:00,  226.52it/s]

     61%|######    | Repairing epochs : 59/97 [00:00<00:00,  219.82it/s]

     66%|######5   | Repairing epochs : 64/97 [00:00<00:00,  218.47it/s]

     68%|######8   | Repairing epochs : 66/97 [00:00<00:00,  210.23it/s]

     70%|#######   | Repairing epochs : 68/97 [00:00<00:00,  202.16it/s]

     72%|#######2  | Repairing epochs : 70/97 [00:00<00:00,  194.93it/s]

     74%|#######4  | Repairing epochs : 72/97 [00:00<00:00,  188.09it/s]

     76%|#######6  | Repairing epochs : 74/97 [00:00<00:00,  181.90it/s]

     78%|#######8  | Repairing epochs : 76/97 [00:00<00:00,  176.79it/s]

     80%|########  | Repairing epochs : 78/97 [00:00<00:00,  172.26it/s]

     82%|########2 | Repairing epochs : 80/97 [00:00<00:00,  167.96it/s]

     85%|########4 | Repairing epochs : 82/97 [00:00<00:00,  164.33it/s]

     87%|########6 | Repairing epochs : 84/97 [00:00<00:00,  161.87it/s]

     89%|########8 | Repairing epochs : 86/97 [00:00<00:00,  158.06it/s]

     91%|######### | Repairing epochs : 88/97 [00:00<00:00,  155.11it/s]

     93%|#########2| Repairing epochs : 90/97 [00:00<00:00,  152.37it/s]

     95%|#########4| Repairing epochs : 92/97 [00:00<00:00,  150.45it/s]

     97%|#########6| Repairing epochs : 94/97 [00:00<00:00,  148.62it/s]

     99%|#########8| Repairing epochs : 96/97 [00:00<00:00,  146.44it/s]    100%|##########| Repairing epochs : 97/97 [00:00<00:00,  166.39it/s]
    Dropped 27 epochs: 54, 58, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 86, 89, 91, 92, 95, 96




.. GENERATED FROM PYTHON SOURCE LINES 86-87

visualize the dropped epochs

.. GENERATED FROM PYTHON SOURCE LINES 87-89

.. code-block:: default

    epochs[reject_log.bad_epochs].plot(scalings=dict(eeg=100e-6))




.. image-sg:: /auto_examples/images/sphx_glr_plot_autoreject_workflow_002.png
   :alt: plot autoreject workflow
   :srcset: /auto_examples/images/sphx_glr_plot_autoreject_workflow_002.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Using matplotlib as 2D backend.

    <MNEBrowseFigure size 800x800 with 4 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 90-91

and the reject log

.. GENERATED FROM PYTHON SOURCE LINES 91-93

.. code-block:: default

    reject_log.plot('horizontal')




.. image-sg:: /auto_examples/images/sphx_glr_plot_autoreject_workflow_003.png
   :alt: plot autoreject workflow
   :srcset: /auto_examples/images/sphx_glr_plot_autoreject_workflow_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <Figure size 1200x600 with 1 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 94-108

Autoreject with high-pass filter
--------------------------------
The data may be very valuable and the time for the experiment
limited and so we may want to take steps to reduce the number of
epochs dropped by first using other steps to preprocess the data.
We will use a high-pass filter first to remove slow drift that could
cause epochs to be dropped.

When making this decision to filter the data, we do want to be careful
because filtering can spread sharp, high-frequency transients and
distort the phase of the signal. Most evoked response potential
analyses use filtering since the interest is in the time series, but
if you are doing a frequency based analysis, filtering before the
Fourier transform could potentially be avoided by detrending instead.

.. GENERATED FROM PYTHON SOURCE LINES 108-116

.. code-block:: default


    raw.filter(l_freq=1, h_freq=None)
    epochs = mne.make_fixed_length_epochs(raw, duration=3, preload=True)
    ar = autoreject.AutoReject(n_interpolate=[1, 2, 3, 4], random_state=11,
                               n_jobs=1, verbose=True)
    ar.fit(epochs[:20])  # fit on a few epochs to save time
    epochs_ar, reject_log = ar.transform(epochs, return_log=True)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Filtering raw data in 1 contiguous segment
    Setting up high-pass filter at 1 Hz

    FIR filter parameters
    ---------------------
    Designing a one-pass, zero-phase, non-causal highpass filter:
    - Windowed time-domain design (firwin) method
    - Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
    - Lower passband edge: 1.00
    - Lower transition bandwidth: 1.00 Hz (-6 dB cutoff frequency: 0.50 Hz)
    - Filter length: 1691 samples (3.303 sec)

    [Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
    [Parallel(n_jobs=1)]: Done   1 out of   1 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   2 out of   2 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   3 out of   3 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   4 out of   4 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done  32 out of  32 | elapsed:    0.1s finished
    Not setting metadata
    97 matching events found
    No baseline correction applied
    0 projection items activated
    Using data from preloaded Raw for 97 events and 1536 original time points ...
    0 bad epochs dropped
    Running autoreject on ch_type=eeg
      0%|          | Creating augmented epochs : 0/32 [00:00<?,       ?it/s]      6%|6         | Creating augmented epochs : 2/32 [00:00<00:00,  122.12it/s]     12%|#2        | Creating augmented epochs : 4/32 [00:00<00:00,  114.13it/s]     19%|#8        | Creating augmented epochs : 6/32 [00:00<00:00,  112.92it/s]     25%|##5       | Creating augmented epochs : 8/32 [00:00<00:00,  114.01it/s]     31%|###1      | Creating augmented epochs : 10/32 [00:00<00:00,  113.62it/s]     38%|###7      | Creating augmented epochs : 12/32 [00:00<00:00,  113.42it/s]     44%|####3     | Creating augmented epochs : 14/32 [00:00<00:00,  112.82it/s]     50%|#####     | Creating augmented epochs : 16/32 [00:00<00:00,  113.13it/s]     56%|#####6    | Creating augmented epochs : 18/32 [00:00<00:00,  113.35it/s]     62%|######2   | Creating augmented epochs : 20/32 [00:00<00:00,  113.05it/s]     69%|######8   | Creating augmented epochs : 22/32 [00:00<00:00,  112.45it/s]     75%|#######5  | Creating augmented epochs : 24/32 [00:00<00:00,  112.80it/s]     81%|########1 | Creating augmented epochs : 26/32 [00:00<00:00,  113.04it/s]     88%|########7 | Creating augmented epochs : 28/32 [00:00<00:00,  112.97it/s]     94%|#########3| Creating augmented epochs : 30/32 [00:00<00:00,  112.54it/s]    100%|##########| Creating augmented epochs : 32/32 [00:00<00:00,  112.11it/s]    100%|##########| Creating augmented epochs : 32/32 [00:00<00:00,  112.31it/s]
      0%|          | Computing thresholds ... : 0/32 [00:00<?,       ?it/s]      3%|3         | Computing thresholds ... : 1/32 [00:00<00:10,    3.07it/s]      6%|6         | Computing thresholds ... : 2/32 [00:00<00:09,    3.07it/s]      9%|9         | Computing thresholds ... : 3/32 [00:00<00:09,    3.07it/s]     12%|#2        | Computing thresholds ... : 4/32 [00:01<00:09,    3.06it/s]     16%|#5        | Computing thresholds ... : 5/32 [00:01<00:08,    3.06it/s]     19%|#8        | Computing thresholds ... : 6/32 [00:01<00:08,    3.06it/s]     22%|##1       | Computing thresholds ... : 7/32 [00:02<00:08,    3.06it/s]     25%|##5       | Computing thresholds ... : 8/32 [00:02<00:07,    3.06it/s]     28%|##8       | Computing thresholds ... : 9/32 [00:02<00:07,    3.06it/s]     31%|###1      | Computing thresholds ... : 10/32 [00:03<00:07,    3.06it/s]     34%|###4      | Computing thresholds ... : 11/32 [00:03<00:06,    3.06it/s]     38%|###7      | Computing thresholds ... : 12/32 [00:03<00:06,    3.06it/s]     41%|####      | Computing thresholds ... : 13/32 [00:04<00:06,    3.07it/s]     44%|####3     | Computing thresholds ... : 14/32 [00:04<00:05,    3.07it/s]     47%|####6     | Computing thresholds ... : 15/32 [00:04<00:05,    3.06it/s]     50%|#####     | Computing thresholds ... : 16/32 [00:05<00:05,    3.06it/s]     53%|#####3    | Computing thresholds ... : 17/32 [00:05<00:04,    3.06it/s]     56%|#####6    | Computing thresholds ... : 18/32 [00:05<00:04,    3.05it/s]     59%|#####9    | Computing thresholds ... : 19/32 [00:06<00:04,    3.05it/s]     62%|######2   | Computing thresholds ... : 20/32 [00:06<00:03,    3.04it/s]     66%|######5   | Computing thresholds ... : 21/32 [00:06<00:03,    3.04it/s]     69%|######8   | Computing thresholds ... : 22/32 [00:07<00:03,    3.04it/s]     72%|#######1  | Computing thresholds ... : 23/32 [00:07<00:02,    3.03it/s]     75%|#######5  | Computing thresholds ... : 24/32 [00:07<00:02,    3.03it/s]     78%|#######8  | Computing thresholds ... : 25/32 [00:08<00:02,    3.03it/s]     81%|########1 | Computing thresholds ... : 26/32 [00:08<00:01,    3.02it/s]     84%|########4 | Computing thresholds ... : 27/32 [00:08<00:01,    3.02it/s]     88%|########7 | Computing thresholds ... : 28/32 [00:09<00:01,    3.02it/s]     91%|######### | Computing thresholds ... : 29/32 [00:09<00:00,    3.01it/s]     94%|#########3| Computing thresholds ... : 30/32 [00:09<00:00,    3.02it/s]     97%|#########6| Computing thresholds ... : 31/32 [00:10<00:00,    3.02it/s]    100%|##########| Computing thresholds ... : 32/32 [00:10<00:00,    3.02it/s]    100%|##########| Computing thresholds ... : 32/32 [00:10<00:00,    3.03it/s]


      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     40%|####      | Repairing epochs : 8/20 [00:00<00:00,  463.52it/s]

     80%|########  | Repairing epochs : 16/20 [00:00<00:00,  464.36it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  462.50it/s]

      0%|          | n_interp : 0/4 [00:00<?,       ?it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     10%|#         | Repairing epochs : 2/20 [00:00<00:00,  100.29it/s]

     25%|##5       | Repairing epochs : 5/20 [00:00<00:00,  127.69it/s]

     35%|###5      | Repairing epochs : 7/20 [00:00<00:00,  122.88it/s]

     60%|######    | Repairing epochs : 12/20 [00:00<00:00,  148.95it/s]

     75%|#######5  | Repairing epochs : 15/20 [00:00<00:00,  148.04it/s]

     85%|########5 | Repairing epochs : 17/20 [00:00<00:00,  142.37it/s]

     95%|#########5| Repairing epochs : 19/20 [00:00<00:00,  138.63it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  136.26it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   14.26it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   16.31it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   17.84it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   18.69it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   19.23it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   19.58it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   19.82it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   19.98it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   20.08it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   20.17it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   19.95it/s]

     25%|##5       | n_interp : 1/4 [00:00<00:01,    1.50it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     15%|#5        | Repairing epochs : 3/20 [00:00<00:00,  152.85it/s]

     35%|###5      | Repairing epochs : 7/20 [00:00<00:00,  165.76it/s]

     60%|######    | Repairing epochs : 12/20 [00:00<00:00,  178.40it/s]

     75%|#######5  | Repairing epochs : 15/20 [00:00<00:00,  166.84it/s]

     85%|########5 | Repairing epochs : 17/20 [00:00<00:00,  157.49it/s]

     95%|#########5| Repairing epochs : 19/20 [00:00<00:00,  151.42it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  153.33it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   21.48it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   21.70it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   21.80it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   21.86it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   21.88it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   21.90it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   21.90it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   21.90it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   21.89it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   21.87it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   21.85it/s]

     50%|#####     | n_interp : 2/4 [00:01<00:01,    1.58it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     15%|#5        | Repairing epochs : 3/20 [00:00<00:00,  173.79it/s]

     35%|###5      | Repairing epochs : 7/20 [00:00<00:00,  175.13it/s]

     60%|######    | Repairing epochs : 12/20 [00:00<00:00,  182.41it/s]

     75%|#######5  | Repairing epochs : 15/20 [00:00<00:00,  168.98it/s]

     85%|########5 | Repairing epochs : 17/20 [00:00<00:00,  159.25it/s]

     95%|#########5| Repairing epochs : 19/20 [00:00<00:00,  153.10it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  155.63it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   21.21it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   21.39it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   21.46it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   21.48it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   21.49it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   21.50it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   21.50it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   21.50it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   21.50it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   21.51it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   21.49it/s]

     75%|#######5  | n_interp : 3/4 [00:01<00:00,    1.61it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     15%|#5        | Repairing epochs : 3/20 [00:00<00:00,  181.71it/s]

     35%|###5      | Repairing epochs : 7/20 [00:00<00:00,  177.22it/s]

     60%|######    | Repairing epochs : 12/20 [00:00<00:00,  184.42it/s]

     75%|#######5  | Repairing epochs : 15/20 [00:00<00:00,  171.41it/s]

     85%|########5 | Repairing epochs : 17/20 [00:00<00:00,  160.96it/s]

     95%|#########5| Repairing epochs : 19/20 [00:00<00:00,  153.98it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  156.65it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   23.07it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   23.33it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   23.43it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   23.46it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   23.44it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   23.43it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   23.35it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   23.30it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   23.23it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   23.21it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   23.22it/s]

    100%|##########| n_interp : 4/4 [00:02<00:00,    1.64it/s]    100%|##########| n_interp : 4/4 [00:02<00:00,    1.64it/s]




    Estimated consensus=0.40 and n_interpolate=4


      0%|          | Repairing epochs : 0/97 [00:00<?,       ?it/s]

      3%|3         | Repairing epochs : 3/97 [00:00<00:00,  186.10it/s]

      7%|7         | Repairing epochs : 7/97 [00:00<00:00,  180.77it/s]

     12%|#2        | Repairing epochs : 12/97 [00:00<00:00,  186.10it/s]

     15%|#5        | Repairing epochs : 15/97 [00:00<00:00,  178.22it/s]

     18%|#7        | Repairing epochs : 17/97 [00:00<00:00,  166.28it/s]

     20%|#9        | Repairing epochs : 19/97 [00:00<00:00,  157.10it/s]

     23%|##2       | Repairing epochs : 22/97 [00:00<00:00,  160.10it/s]

     26%|##5       | Repairing epochs : 25/97 [00:00<00:00,  163.35it/s]

     29%|##8       | Repairing epochs : 28/97 [00:00<00:00,  165.44it/s]

     32%|###1      | Repairing epochs : 31/97 [00:00<00:00,  166.81it/s]

     35%|###5      | Repairing epochs : 34/97 [00:00<00:00,  167.94it/s]

     37%|###7      | Repairing epochs : 36/97 [00:00<00:00,  161.66it/s]

     39%|###9      | Repairing epochs : 38/97 [00:00<00:00,  156.47it/s]

     41%|####1     | Repairing epochs : 40/97 [00:00<00:00,  152.64it/s]

     43%|####3     | Repairing epochs : 42/97 [00:00<00:00,  148.71it/s]

     45%|####5     | Repairing epochs : 44/97 [00:00<00:00,  146.28it/s]

     47%|####7     | Repairing epochs : 46/97 [00:00<00:00,  143.54it/s]

     49%|####9     | Repairing epochs : 48/97 [00:00<00:00,  141.66it/s]

     52%|#####1    | Repairing epochs : 50/97 [00:00<00:00,  139.29it/s]

     54%|#####3    | Repairing epochs : 52/97 [00:00<00:00,  137.55it/s]

     57%|#####6    | Repairing epochs : 55/97 [00:00<00:00,  140.72it/s]

     60%|#####9    | Repairing epochs : 58/97 [00:00<00:00,  141.70it/s]

     62%|######1   | Repairing epochs : 60/97 [00:00<00:00,  139.44it/s]

     64%|######3   | Repairing epochs : 62/97 [00:00<00:00,  137.50it/s]

     66%|######5   | Repairing epochs : 64/97 [00:00<00:00,  135.71it/s]

     68%|######8   | Repairing epochs : 66/97 [00:00<00:00,  134.12it/s]

     70%|#######   | Repairing epochs : 68/97 [00:00<00:00,  132.90it/s]

     72%|#######2  | Repairing epochs : 70/97 [00:00<00:00,  131.27it/s]

     74%|#######4  | Repairing epochs : 72/97 [00:00<00:00,  130.71it/s]

     77%|#######7  | Repairing epochs : 75/97 [00:00<00:00,  133.49it/s]

     80%|########  | Repairing epochs : 78/97 [00:00<00:00,  136.23it/s]

     85%|########4 | Repairing epochs : 82/97 [00:00<00:00,  140.32it/s]

     88%|########7 | Repairing epochs : 85/97 [00:00<00:00,  142.41it/s]

     92%|#########1| Repairing epochs : 89/97 [00:00<00:00,  145.67it/s]

     95%|#########4| Repairing epochs : 92/97 [00:00<00:00,  147.53it/s]

     98%|#########7| Repairing epochs : 95/97 [00:00<00:00,  149.51it/s]    100%|##########| Repairing epochs : 97/97 [00:00<00:00,  147.68it/s]
    Dropped 23 epochs: 62, 63, 64, 65, 67, 68, 69, 70, 71, 72, 73, 75, 76, 77, 78, 79, 80, 86, 89, 91, 92, 95, 96




.. GENERATED FROM PYTHON SOURCE LINES 117-118

visualize the dropped epochs

.. GENERATED FROM PYTHON SOURCE LINES 118-120

.. code-block:: default

    epochs[reject_log.bad_epochs].plot(scalings=dict(eeg=100e-6))




.. image-sg:: /auto_examples/images/sphx_glr_plot_autoreject_workflow_004.png
   :alt: plot autoreject workflow
   :srcset: /auto_examples/images/sphx_glr_plot_autoreject_workflow_004.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <MNEBrowseFigure size 800x800 with 4 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 121-123

and the reject log. As we can see in the plot, high-pass filtering reduced
the number of epochs marked as bad by autoreject substantially.

.. GENERATED FROM PYTHON SOURCE LINES 123-125

.. code-block:: default

    reject_log.plot('horizontal')




.. image-sg:: /auto_examples/images/sphx_glr_plot_autoreject_workflow_005.png
   :alt: plot autoreject workflow
   :srcset: /auto_examples/images/sphx_glr_plot_autoreject_workflow_005.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <Figure size 1200x600 with 1 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 126-138

ICA
---
Finally, we can apply independent components analysis (ICA) to remove
eyeblinks from the data. If our analysis were to be very dependent on
sensors at the front of the head, we could skip ICA and use the previous
result. However, ICA can increase the amount of usable data by applying
a spatial filter that downscales the data in sensors most affected by
eyeblink artifacts.

Note that ICA works best if bad segments of the data are removed
Hence, we will remove the bad segments from the
previous run of autoreject for the benefit of the ICA algorithm.

.. GENERATED FROM PYTHON SOURCE LINES 138-143

.. code-block:: default


    # compute ICA
    ica = mne.preprocessing.ICA(random_state=99)
    ica.fit(epochs[~reject_log.bad_epochs])





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Fitting ICA to data using 32 channels (please be patient, this may take a while)
    Selecting by non-zero PCA components: 32 components
    Fitting ICA took 3.2s.


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <table class="table table-hover table-striped table-sm table-responsive small">
        <tr>
            <th>Method</th>
            <td>fastica</td>
        </tr>
        <tr>
            <th>Fit</th>
            <td>49 iterations on epochs (113664 samples)</td>
        </tr>
    
        <tr>
            <th>ICA components</th>
            <td>32</td>
        </tr>
        <tr>
            <th>Explained variance</th>
            <td>100.0&nbsp;%</td>
        </tr>
        <tr>
            <th>Available PCA components</th>
            <td>32</td>
        </tr>
        <tr>
            <th>Channel types</th>
            <td>eeg</td>
        </tr>
        <tr>
            <th>ICA components marked for exclusion</th>
            <td>&mdash;</td>
        </tr>
    
    </table>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 144-148

We can see in the plots below that ICA effectively removed eyeblink
artifact.

plot source components to see which is made up of blinks

.. GENERATED FROM PYTHON SOURCE LINES 148-154

.. code-block:: default

    exclude = [0,  # blinks
               2  # saccades
               ]
    ica.plot_components(exclude)
    ica.exclude = exclude




.. image-sg:: /auto_examples/images/sphx_glr_plot_autoreject_workflow_006.png
   :alt: ICA components, ICA000, ICA002
   :srcset: /auto_examples/images/sphx_glr_plot_autoreject_workflow_006.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 155-156

plot with and without eyeblink component

.. GENERATED FROM PYTHON SOURCE LINES 156-159

.. code-block:: default

    ica.plot_overlay(epochs.average(), exclude=ica.exclude)
    ica.apply(epochs, exclude=ica.exclude)




.. image-sg:: /auto_examples/images/sphx_glr_plot_autoreject_workflow_007.png
   :alt: Signals before (red) and after (black) cleaning, EEG (32 channels)
   :srcset: /auto_examples/images/sphx_glr_plot_autoreject_workflow_007.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Applying ICA to Evoked instance
        Transforming to ICA space (32 components)
        Zeroing out 2 ICA components
        Projecting back using 32 PCA components
    Applying ICA to Epochs instance
        Transforming to ICA space (32 components)
        Zeroing out 2 ICA components
        Projecting back using 32 PCA components


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <table class="table table-hover table-striped table-sm table-responsive small">
        <tr>
            <th>Number of events</th>
            <td>97</td>
        </tr>
        <tr>
            <th>Events</th>
        
            <td>1: 97</td>
        
        </tr>
        <tr>
            <th>Time range</th>
            <td>0.000 – 2.998 sec</td>
        </tr>
        <tr>
            <th>Baseline</th>
            <td>off</td>
        </tr>
    </table>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 160-173

Autoreject with highpass filter and ICA
---------------------------------------
We can see in this section that preprocessing, especially ICA, can be made
to do a lot of the heavy lifting. There isn't a huge difference when viewing
the averaged data because the ICA effectively limited the number
of epochs that had to be dropped. However, there are still artifacts such as
non-stereotypical blinks that weren't able to be removed by ICA, channel
"pops" (sharp transients with exponential RC decay), muscle artifact such as
jaw clenches and gross movement artifact that could still impact analyses.

These are the basic steps for a workflow with decisions that must be
made based on what the data is being used for. Following this may help
you optimize your use of ``autoreject`` in preprocessing.

.. GENERATED FROM PYTHON SOURCE LINES 173-181

.. code-block:: default


    # compute channel-level rejections
    ar = autoreject.AutoReject(n_interpolate=[1, 2, 3, 4], random_state=11,
                               n_jobs=1, verbose=True)
    ar.fit(epochs[:20])  # fit on the first 20 epochs to save time
    epochs_ar, reject_log = ar.transform(epochs, return_log=True)
    epochs[reject_log.bad_epochs].plot(scalings=dict(eeg=100e-6))




.. image-sg:: /auto_examples/images/sphx_glr_plot_autoreject_workflow_008.png
   :alt: plot autoreject workflow
   :srcset: /auto_examples/images/sphx_glr_plot_autoreject_workflow_008.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Running autoreject on ch_type=eeg
      0%|          | Creating augmented epochs : 0/32 [00:00<?,       ?it/s]      9%|9         | Creating augmented epochs : 3/32 [00:00<00:00,  121.61it/s]     16%|#5        | Creating augmented epochs : 5/32 [00:00<00:00,  117.96it/s]     22%|##1       | Creating augmented epochs : 7/32 [00:00<00:00,  116.30it/s]     28%|##8       | Creating augmented epochs : 9/32 [00:00<00:00,  114.77it/s]     34%|###4      | Creating augmented epochs : 11/32 [00:00<00:00,  114.06it/s]     41%|####      | Creating augmented epochs : 13/32 [00:00<00:00,  114.31it/s]     47%|####6     | Creating augmented epochs : 15/32 [00:00<00:00,  113.21it/s]     53%|#####3    | Creating augmented epochs : 17/32 [00:00<00:00,  113.54it/s]     59%|#####9    | Creating augmented epochs : 19/32 [00:00<00:00,  113.08it/s]     66%|######5   | Creating augmented epochs : 21/32 [00:00<00:00,  113.89it/s]     72%|#######1  | Creating augmented epochs : 23/32 [00:00<00:00,  113.52it/s]     78%|#######8  | Creating augmented epochs : 25/32 [00:00<00:00,  113.91it/s]     84%|########4 | Creating augmented epochs : 27/32 [00:00<00:00,  114.62it/s]     91%|######### | Creating augmented epochs : 29/32 [00:00<00:00,  114.05it/s]     97%|#########6| Creating augmented epochs : 31/32 [00:00<00:00,  113.48it/s]    100%|##########| Creating augmented epochs : 32/32 [00:00<00:00,  113.53it/s]
      0%|          | Computing thresholds ... : 0/32 [00:00<?,       ?it/s]      3%|3         | Computing thresholds ... : 1/32 [00:00<00:10,    2.83it/s]      6%|6         | Computing thresholds ... : 2/32 [00:00<00:10,    2.91it/s]      9%|9         | Computing thresholds ... : 3/32 [00:01<00:09,    2.95it/s]     12%|#2        | Computing thresholds ... : 4/32 [00:01<00:09,    2.97it/s]     16%|#5        | Computing thresholds ... : 5/32 [00:01<00:09,    2.99it/s]     19%|#8        | Computing thresholds ... : 6/32 [00:02<00:08,    3.00it/s]     22%|##1       | Computing thresholds ... : 7/32 [00:02<00:08,    3.01it/s]     25%|##5       | Computing thresholds ... : 8/32 [00:02<00:07,    3.01it/s]     28%|##8       | Computing thresholds ... : 9/32 [00:02<00:07,    3.02it/s]     31%|###1      | Computing thresholds ... : 10/32 [00:03<00:07,    3.02it/s]     34%|###4      | Computing thresholds ... : 11/32 [00:03<00:06,    3.03it/s]     38%|###7      | Computing thresholds ... : 12/32 [00:03<00:06,    3.03it/s]     41%|####      | Computing thresholds ... : 13/32 [00:04<00:06,    3.04it/s]     44%|####3     | Computing thresholds ... : 14/32 [00:04<00:05,    3.04it/s]     47%|####6     | Computing thresholds ... : 15/32 [00:04<00:05,    3.05it/s]     50%|#####     | Computing thresholds ... : 16/32 [00:05<00:05,    3.05it/s]     53%|#####3    | Computing thresholds ... : 17/32 [00:05<00:04,    3.06it/s]     56%|#####6    | Computing thresholds ... : 18/32 [00:05<00:04,    3.06it/s]     59%|#####9    | Computing thresholds ... : 19/32 [00:06<00:04,    3.06it/s]     62%|######2   | Computing thresholds ... : 20/32 [00:06<00:03,    3.06it/s]     66%|######5   | Computing thresholds ... : 21/32 [00:06<00:03,    3.06it/s]     69%|######8   | Computing thresholds ... : 22/32 [00:07<00:03,    3.06it/s]     72%|#######1  | Computing thresholds ... : 23/32 [00:07<00:02,    3.06it/s]     75%|#######5  | Computing thresholds ... : 24/32 [00:07<00:02,    3.06it/s]     78%|#######8  | Computing thresholds ... : 25/32 [00:08<00:02,    3.06it/s]     81%|########1 | Computing thresholds ... : 26/32 [00:08<00:01,    3.06it/s]     84%|########4 | Computing thresholds ... : 27/32 [00:08<00:01,    3.05it/s]     88%|########7 | Computing thresholds ... : 28/32 [00:09<00:01,    3.05it/s]     91%|######### | Computing thresholds ... : 29/32 [00:09<00:00,    3.05it/s]     94%|#########3| Computing thresholds ... : 30/32 [00:09<00:00,    3.05it/s]     97%|#########6| Computing thresholds ... : 31/32 [00:10<00:00,    3.05it/s]    100%|##########| Computing thresholds ... : 32/32 [00:10<00:00,    3.05it/s]    100%|##########| Computing thresholds ... : 32/32 [00:10<00:00,    3.05it/s]


      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     40%|####      | Repairing epochs : 8/20 [00:00<00:00,  461.98it/s]

     80%|########  | Repairing epochs : 16/20 [00:00<00:00,  460.03it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  458.40it/s]

      0%|          | n_interp : 0/4 [00:00<?,       ?it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     25%|##5       | Repairing epochs : 5/20 [00:00<00:00,  292.23it/s]

     50%|#####     | Repairing epochs : 10/20 [00:00<00:00,  243.95it/s]

     70%|#######   | Repairing epochs : 14/20 [00:00<00:00,  220.11it/s]

     80%|########  | Repairing epochs : 16/20 [00:00<00:00,  192.78it/s]

     90%|######### | Repairing epochs : 18/20 [00:00<00:00,  177.82it/s]

    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  167.28it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  171.59it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   13.73it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   15.97it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   17.48it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   18.31it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   18.86it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   19.25it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   19.53it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   19.71it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   19.85it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   19.98it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   19.73it/s]

     25%|##5       | n_interp : 1/4 [00:00<00:01,    1.57it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     30%|###       | Repairing epochs : 6/20 [00:00<00:00,  339.94it/s]

     55%|#####5    | Repairing epochs : 11/20 [00:00<00:00,  316.65it/s]

     70%|#######   | Repairing epochs : 14/20 [00:00<00:00,  253.28it/s]

     80%|########  | Repairing epochs : 16/20 [00:00<00:00,  213.90it/s]

     90%|######### | Repairing epochs : 18/20 [00:00<00:00,  194.67it/s]

    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  180.70it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  186.88it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   14.09it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   16.22it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   17.68it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   18.52it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   19.03it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   19.39it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   19.68it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   19.89it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   20.06it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   20.19it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   19.94it/s]

     50%|#####     | n_interp : 2/4 [00:01<00:01,    1.59it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     30%|###       | Repairing epochs : 6/20 [00:00<00:00,  342.83it/s]

     50%|#####     | Repairing epochs : 10/20 [00:00<00:00,  294.50it/s]

     70%|#######   | Repairing epochs : 14/20 [00:00<00:00,  248.83it/s]

     80%|########  | Repairing epochs : 16/20 [00:00<00:00,  206.75it/s]

     90%|######### | Repairing epochs : 18/20 [00:00<00:00,  187.85it/s]

    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  175.93it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  181.60it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   13.69it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   15.96it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   17.46it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   18.33it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   18.87it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   19.26it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   19.56it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   19.75it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   19.87it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   19.96it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   19.72it/s]

     75%|#######5  | n_interp : 3/4 [00:01<00:00,    1.59it/s]

      0%|          | Repairing epochs : 0/20 [00:00<?,       ?it/s]

     30%|###       | Repairing epochs : 6/20 [00:00<00:00,  341.66it/s]

     55%|#####5    | Repairing epochs : 11/20 [00:00<00:00,  306.67it/s]

     70%|#######   | Repairing epochs : 14/20 [00:00<00:00,  249.22it/s]

     80%|########  | Repairing epochs : 16/20 [00:00<00:00,  209.60it/s]

     90%|######### | Repairing epochs : 18/20 [00:00<00:00,  190.15it/s]

    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  177.31it/s]    100%|##########| Repairing epochs : 20/20 [00:00<00:00,  183.36it/s]



      0%|          | Fold : 0/10 [00:00<?,       ?it/s]


     10%|#         | Fold : 1/10 [00:00<00:00,   15.47it/s]


     20%|##        | Fold : 2/10 [00:00<00:00,   17.40it/s]


     30%|###       | Fold : 3/10 [00:00<00:00,   19.07it/s]


     40%|####      | Fold : 4/10 [00:00<00:00,   20.07it/s]


     50%|#####     | Fold : 5/10 [00:00<00:00,   20.72it/s]


     60%|######    | Fold : 6/10 [00:00<00:00,   21.20it/s]


     70%|#######   | Fold : 7/10 [00:00<00:00,   21.55it/s]


     80%|########  | Fold : 8/10 [00:00<00:00,   21.81it/s]


     90%|######### | Fold : 9/10 [00:00<00:00,   22.00it/s]


    100%|##########| Fold : 10/10 [00:00<00:00,   22.17it/s]    100%|##########| Fold : 10/10 [00:00<00:00,   21.86it/s]

    100%|##########| n_interp : 4/4 [00:02<00:00,    1.63it/s]    100%|##########| n_interp : 4/4 [00:02<00:00,    1.63it/s]




    Estimated consensus=0.40 and n_interpolate=2


      0%|          | Repairing epochs : 0/97 [00:00<?,       ?it/s]

      6%|6         | Repairing epochs : 6/97 [00:00<00:00,  354.29it/s]

     11%|#1        | Repairing epochs : 11/97 [00:00<00:00,  314.18it/s]

     14%|#4        | Repairing epochs : 14/97 [00:00<00:00,  253.83it/s]

     16%|#6        | Repairing epochs : 16/97 [00:00<00:00,  214.56it/s]

     19%|#8        | Repairing epochs : 18/97 [00:00<00:00,  194.22it/s]

     21%|##        | Repairing epochs : 20/97 [00:00<00:00,  180.60it/s]

     23%|##2       | Repairing epochs : 22/97 [00:00<00:00,  170.57it/s]

     25%|##4       | Repairing epochs : 24/97 [00:00<00:00,  163.64it/s]

     27%|##6       | Repairing epochs : 26/97 [00:00<00:00,  157.66it/s]

     29%|##8       | Repairing epochs : 28/97 [00:00<00:00,  151.30it/s]

     31%|###       | Repairing epochs : 30/97 [00:00<00:00,  147.50it/s]

     33%|###2      | Repairing epochs : 32/97 [00:00<00:00,  143.38it/s]

     35%|###5      | Repairing epochs : 34/97 [00:00<00:00,  140.94it/s]

     37%|###7      | Repairing epochs : 36/97 [00:00<00:00,  138.08it/s]

     39%|###9      | Repairing epochs : 38/97 [00:00<00:00,  135.24it/s]

     42%|####2     | Repairing epochs : 41/97 [00:00<00:00,  136.11it/s]

     44%|####4     | Repairing epochs : 43/97 [00:00<00:00,  133.36it/s]

     46%|####6     | Repairing epochs : 45/97 [00:00<00:00,  131.79it/s]

     48%|####8     | Repairing epochs : 47/97 [00:00<00:00,  130.45it/s]

     52%|#####1    | Repairing epochs : 50/97 [00:00<00:00,  132.25it/s]

     54%|#####3    | Repairing epochs : 52/97 [00:00<00:00,  131.21it/s]

     57%|#####6    | Repairing epochs : 55/97 [00:00<00:00,  131.00it/s]

     60%|#####9    | Repairing epochs : 58/97 [00:00<00:00,  132.65it/s]

     63%|######2   | Repairing epochs : 61/97 [00:00<00:00,  131.10it/s]

     66%|######5   | Repairing epochs : 64/97 [00:00<00:00,  132.01it/s]

     68%|######8   | Repairing epochs : 66/97 [00:00<00:00,  130.91it/s]

     70%|#######   | Repairing epochs : 68/97 [00:00<00:00,  129.80it/s]

     72%|#######2  | Repairing epochs : 70/97 [00:00<00:00,  129.12it/s]

     75%|#######5  | Repairing epochs : 73/97 [00:00<00:00,  131.27it/s]

     78%|#######8  | Repairing epochs : 76/97 [00:00<00:00,  133.69it/s]

     81%|########1 | Repairing epochs : 79/97 [00:00<00:00,  135.96it/s]

     85%|########4 | Repairing epochs : 82/97 [00:00<00:00,  138.13it/s]

     88%|########7 | Repairing epochs : 85/97 [00:00<00:00,  140.27it/s]

     91%|######### | Repairing epochs : 88/97 [00:00<00:00,  142.25it/s]

     94%|#########3| Repairing epochs : 91/97 [00:00<00:00,  143.86it/s]

     97%|#########6| Repairing epochs : 94/97 [00:00<00:00,  145.30it/s]

    100%|##########| Repairing epochs : 97/97 [00:00<00:00,  147.01it/s]    100%|##########| Repairing epochs : 97/97 [00:00<00:00,  143.86it/s]
    Dropped 11 epochs: 62, 63, 64, 65, 69, 71, 72, 73, 80, 95, 96

    <MNEBrowseFigure size 800x800 with 4 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 182-190

We will do a few more visualizations to see that removing the bad epochs
found by ``autoreject`` is still important even with preprocessing first.
This is especially important if your analyses include trial-level statistics
such as looking for bursting activity. We'll visualize why autoreject
excluded these epochs and the effect that including these bad epochs would
have on the data.

First, we will visualize the reject log

.. GENERATED FROM PYTHON SOURCE LINES 190-192

.. code-block:: default

    reject_log.plot('horizontal')




.. image-sg:: /auto_examples/images/sphx_glr_plot_autoreject_workflow_009.png
   :alt: plot autoreject workflow
   :srcset: /auto_examples/images/sphx_glr_plot_autoreject_workflow_009.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <Figure size 1200x600 with 1 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 193-195

Next, we will visualize the cleaned average data and compare it against
the bad segments.

.. GENERATED FROM PYTHON SOURCE LINES 195-200

.. code-block:: default

    evoked_bad = epochs[reject_log.bad_epochs].average()
    plt.figure()
    plt.plot(evoked_bad.times, evoked_bad.data.T * 1e6, 'r', zorder=-1)
    epochs_ar.average().plot(axes=plt.gca())




.. image-sg:: /auto_examples/images/sphx_glr_plot_autoreject_workflow_010.png
   :alt: EEG (32 channels)
   :srcset: /auto_examples/images/sphx_glr_plot_autoreject_workflow_010.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <Figure size 640x480 with 1 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 201-205

As a last optional step, we can do inspect the reject_log and make manual
corrections to the reject_log. For instance, if data is limited, we may
not want to drop epochs but retain the list of bad epochs for quality
assurance metrics.

.. GENERATED FROM PYTHON SOURCE LINES 205-210

.. code-block:: default


    reject_log = ar.get_reject_log(epochs)
    bad_epochs = reject_log.bad_epochs.copy()
    reject_log.bad_epochs[:] = False  # no bad epochs








.. GENERATED FROM PYTHON SOURCE LINES 211-212

The modified reject log can be applied to the data as follows.

.. GENERATED FROM PYTHON SOURCE LINES 212-216

.. code-block:: default

    epochs_ar = ar.transform(epochs, reject_log=reject_log)
    print(f'Number of epochs originally: {len(epochs)}, '
          f'after autoreject: {len(epochs_ar)}')





.. rst-class:: sphx-glr-script-out

 .. code-block:: none



      0%|          | Repairing epochs : 0/97 [00:00<?,       ?it/s]

      6%|6         | Repairing epochs : 6/97 [00:00<00:00,  332.13it/s]

     11%|#1        | Repairing epochs : 11/97 [00:00<00:00,  299.58it/s]

     14%|#4        | Repairing epochs : 14/97 [00:00<00:00,  244.82it/s]

     16%|#6        | Repairing epochs : 16/97 [00:00<00:00,  208.98it/s]

     19%|#8        | Repairing epochs : 18/97 [00:00<00:00,  189.95it/s]

     21%|##        | Repairing epochs : 20/97 [00:00<00:00,  176.75it/s]

     23%|##2       | Repairing epochs : 22/97 [00:00<00:00,  167.29it/s]

     25%|##4       | Repairing epochs : 24/97 [00:00<00:00,  160.78it/s]

     27%|##6       | Repairing epochs : 26/97 [00:00<00:00,  154.88it/s]

     29%|##8       | Repairing epochs : 28/97 [00:00<00:00,  148.81it/s]

     31%|###       | Repairing epochs : 30/97 [00:00<00:00,  145.17it/s]

     33%|###2      | Repairing epochs : 32/97 [00:00<00:00,  141.44it/s]

     35%|###5      | Repairing epochs : 34/97 [00:00<00:00,  139.15it/s]

     37%|###7      | Repairing epochs : 36/97 [00:00<00:00,  136.27it/s]

     39%|###9      | Repairing epochs : 38/97 [00:00<00:00,  133.36it/s]

     42%|####2     | Repairing epochs : 41/97 [00:00<00:00,  134.37it/s]

     44%|####4     | Repairing epochs : 43/97 [00:00<00:00,  131.81it/s]

     46%|####6     | Repairing epochs : 45/97 [00:00<00:00,  130.45it/s]

     48%|####8     | Repairing epochs : 47/97 [00:00<00:00,  129.12it/s]

     52%|#####1    | Repairing epochs : 50/97 [00:00<00:00,  130.98it/s]

     54%|#####3    | Repairing epochs : 52/97 [00:00<00:00,  129.96it/s]

     57%|#####6    | Repairing epochs : 55/97 [00:00<00:00,  129.93it/s]

     60%|#####9    | Repairing epochs : 58/97 [00:00<00:00,  131.44it/s]

     63%|######2   | Repairing epochs : 61/97 [00:00<00:00,  132.30it/s]

     66%|######5   | Repairing epochs : 64/97 [00:00<00:00,  133.65it/s]

     68%|######8   | Repairing epochs : 66/97 [00:00<00:00,  132.29it/s]

     70%|#######   | Repairing epochs : 68/97 [00:00<00:00,  131.26it/s]

     72%|#######2  | Repairing epochs : 70/97 [00:00<00:00,  130.22it/s]

     75%|#######5  | Repairing epochs : 73/97 [00:00<00:00,  131.43it/s]

     78%|#######8  | Repairing epochs : 76/97 [00:00<00:00,  133.79it/s]

     81%|########1 | Repairing epochs : 79/97 [00:00<00:00,  136.06it/s]

     85%|########4 | Repairing epochs : 82/97 [00:00<00:00,  138.25it/s]

     88%|########7 | Repairing epochs : 85/97 [00:00<00:00,  140.39it/s]

     91%|######### | Repairing epochs : 88/97 [00:00<00:00,  142.38it/s]

     94%|#########3| Repairing epochs : 91/97 [00:00<00:00,  144.00it/s]

     97%|#########6| Repairing epochs : 94/97 [00:00<00:00,  145.44it/s]

    100%|##########| Repairing epochs : 97/97 [00:00<00:00,  147.13it/s]    100%|##########| Repairing epochs : 97/97 [00:00<00:00,  143.56it/s]
    No bad epochs were found for your data. Returning a copy of the data you wanted to clean. Interpolation may have been done.
    Number of epochs originally: 97, after autoreject: 97




.. GENERATED FROM PYTHON SOURCE LINES 217-228

Finally, don't forget that we are working with resting state data
here. Here we used long epochs of 3 seconds so that frequency-domain
analysis was possible with the epochs. However, this could also lead
to longer segments of the data being rejected. If you want more
fine-grained control over the artifacts, you can
construct shorter epochs and use the autoreject log to mark
annotations in MNE that can be used to reject the data during doing
time-frequency analysis. We want to emphasize that there
is no subsitute for visual inspection. Irrespective of the rejection
method used, we highly recommend users to inspect their preprocessed
data before further analyses.


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  51.212 seconds)


.. _sphx_glr_download_auto_examples_plot_autoreject_workflow.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_autoreject_workflow.py <plot_autoreject_workflow.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_autoreject_workflow.ipynb <plot_autoreject_workflow.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
